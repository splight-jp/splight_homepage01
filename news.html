<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>お知らせ - 株式会社splight</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Header (省略) -->
    
    <!-- Hero Section -->
    <section class="hero" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 60vh;">
        <div class="hero-content">
            <h1>NEWS</h1>
            <p>お知らせ</p>
        </div>
    </section>

    <!-- News List -->
    <section class="news-section">
        <div class="container">
            <h2>Latest News</h2>
            <h3>最新のお知らせ</h3>
            
            <!-- Loading indicator -->
            <div id="news-loading" style="text-align: center; padding: 50px;">
                <p>読み込み中...</p>
            </div>
            
            <!-- News container -->
            <div id="news-container" class="news-list"></div>
            
            <!-- Load more button -->
            <div class="text-center" style="margin-top: 40px;">
                <button id="load-more-news" class="more-btn" style="display: none;">もっと見る</button>
            </div>
        </div>
    </section>
    
    <!-- Footer (省略) -->
    
    <script src="js/script.js"></script>
    <script>
        let currentPage = 1;
        const postsPerPage = 10;
        
        // お知らせデータを取得
        async function loadNews(page = 1, append = false) {
            try {
                const response = await fetch(`/wp/wp-json/wp/v2/news?per_page=${postsPerPage}&page=${page}&_embed`);
                const totalPages = response.headers.get('X-WP-TotalPages');
                const news = await response.json();
                
                const container = document.getElementById('news-container');
                const loading = document.getElementById('news-loading');
                const loadMoreBtn = document.getElementById('load-more-news');
                
                if (!append) {
                    container.innerHTML = '';
                }
                
                news.forEach(item => {
                    const newsItem = document.createElement('div');
                    newsItem.className = 'news-item';
                    
                    const date = new Date(item.date).toLocaleDateString('ja-JP');
                    const categories = item._embedded['wp:term'] ? item._embedded['wp:term'][0] : [];
                    const category = categories.length > 0 ? categories[0].name : '一般';
                    const categoryClass = getCategoryClass(category);
                    
                    newsItem.innerHTML = `
                        <div class="news-date">${date}</div>
                        <div class="news-category ${categoryClass}">${category}</div>
                        <div class="news-title">
                            <a href="news-detail.html?id=${item.id}">${item.title.rendered}</a>
                        </div>
                    `;
                    container.appendChild(newsItem);
                });
                
                loading.style.display = 'none';
                
                if (page < totalPages) {
                    loadMoreBtn.style.display = 'block';
                } else {
                    loadMoreBtn.style.display = 'none';
                }
                
            } catch (error) {
                console.error('ニュース取得エラー:', error);
                document.getElementById('news-loading').innerHTML = '<p>データの取得に失敗しました。</p>';
            }
        }
        
        function getCategoryClass(category) {
            switch(category) {
                case 'AgriVoltaics': return 'agrivoltaics';
                case 'Self Consumption': return 'self-consumption';
                case 'Materials': return 'materials';
                default: return 'general';
            }
        }
        
        // Load more button event
        document.getElementById('load-more-news').addEventListener('click', function() {
            currentPage++;
            loadNews(currentPage, true);
        });
        
        // Initial load
        loadNews();
    </script>
</body>
</html>
